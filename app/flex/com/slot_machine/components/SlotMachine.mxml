<?xml version="1.0" encoding="utf-8"?>
<s:VGroup
  xmlns:fx="http://ns.adobe.com/mxml/2009"
  xmlns:s="library://ns.adobe.com/flex/spark"
  xmlns:mx="library://ns.adobe.com/flex/mx"
  width="100%"
  height="100%">
  <fx:Script>
    <![CDATA[
      import spark.components.Image;
      import spark.components.VGroup;      
      import mx.controls.Alert; 
      import mx.rpc.http.HTTPService; 
      import mx.rpc.events.ResultEvent; 
      import mx.rpc.events.FaultEvent; 
            
      private var service:HTTPService 
      private var lines_quantity:uint;

      public function useHttpService():void { 
        service = new HTTPService(); 
        service.url = "/machines/load"; 
        service.method = "GET"; 
        service.addEventListener("result", httpResult); 
        service.addEventListener("fault", httpFault); 
        service.send(); 
      } 
 
      public function httpResult(event:ResultEvent):void {
        var rawData:String = String(event.result);
        var result:Object = JSON.parse(rawData);
        
        lines_quantity = result.lines_quantity;
        draw(result.reels);
      }
      
      public function httpFault(event:FaultEvent):void { 
        var faultstring:String = event.fault.faultString; 
        Alert.show(faultstring); 
      }
      
      public function draw(reels:Array):void {
        const ICONS_PATH:String = "/assets/icons/";
        var newImage:Image;
        var newVGroup:VGroup;
        var i:uint;
        var j:uint;
        
        for (i=0; i < reels.length; i++) {
          newVGroup = new VGroup();
          newVGroup.left = 128*i;
          machine.addElement(newVGroup);
          for (j=0; j < lines_quantity; j++) {
            newImage = new Image();
            newImage.source = ICONS_PATH + reels[i][j].image;
            newVGroup.addElement(newImage);
          }
        }
      }
    
      public function loadMachine():void {
        useHttpService();
      }
    ]]>
  </fx:Script>

  <s:Group id="machine" height="100%" width="100%" initialize="loadMachine();"/>
  
</s:VGroup>